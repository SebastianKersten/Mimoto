{"version":3,"file":"js/publisher.js","sources":["webpack:///webpack/bootstrap 9b4065f641ea8d45e869","webpack:///src/userinterface/publisher/publisher.js","webpack:///src/userinterface/publisher/Publisher/Publisher.js","webpack:///src/userinterface/publisher/Article/Article.js","webpack:///src/userinterface/publisher/Editor/Editor.js"],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// __webpack_hash__\n \t__webpack_require__.h = \"9b4065f641ea8d45e869\";\n\n \t// __webpack_chunkname__\n \t__webpack_require__.cn = \"js/publisher.js\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 456);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 9b4065f641ea8d45e869","/**\n * Mimoto.Publisher - Demo - How to build a publication platform\n *\n * @author Sebastian Kersten (@supertaboo)\n */\n\n\n'use strict';\n\n\n// Publisher demo classes\nlet Publisher = require('./Publisher/Publisher');\n\n\n/**\n * Auto run\n */\ndocument.addEventListener('DOMContentLoaded', function ()\n{\n    // init\n    window.Publisher = new Publisher();\n\n}, false);\n\n\n\n// WEBPACK FOOTER //\n// src/userinterface/publisher/publisher.js","/**\n * Mimoto.Publisher - Demo - How to build a publication platform\n *\n * @author Sebastian Kersten (@supertaboo)\n */\n\n\n'use strict';\n\n\n// Mimoto classes\nlet Article = require('../Article/Article');\nlet Editor = require('../Editor/Editor');\n\n\nmodule.exports = function() {\n\n    // start\n    this.__construct();\n};\n\nmodule.exports.prototype = {\n\n\n    // feature: is typing\n    _aUsersInCommentField: [],\n    _elIsTypingMessage: null,\n    _isTypingChannel: null,\n    _alsoOnThisPageChannel: null,\n    _aClientsOnThisPage: [],\n\n\n\n    // ----------------------------------------------------------------------------\n    // --- Properties -------------------------------------------------------------\n    // ----------------------------------------------------------------------------\n\n\n    article: null,\n    editor: null,\n\n\n\n    // ----------------------------------------------------------------------------\n    // --- Constructor ------------------------------------------------------------\n    // ----------------------------------------------------------------------------\n\n\n    /**\n     * Constructor\n     */\n    __construct: function()\n    {\n        // connect\n        this._setupArticle();\n    },\n\n\n\n    // ----------------------------------------------------------------------------\n    // --- Private methods --------------------------------------------------------\n    // ----------------------------------------------------------------------------\n\n\n    alsoOnThisPage: function(channel)\n    {\n        // register\n        this._alsoOnThisPageChannel = channel;\n\n        //channel.onOtherJoined = function(client) {\n        channel.onConnected = function() {\n\n            // broadcast\n            channel.identify({ firstName: Mimoto.user.firstName, lastName: Mimoto.user.lastName, avatar: Mimoto.user.avatar });\n\n        }.bind(this);\n\n        // //channel.onOtherJoined = function(client) {\n        // channel.onOtherConnected = function(clientId) {\n        //\n        //     this._aClientsOnThisPage[clientId] = {\n        //         isNew: true\n        //     }\n        //\n        // }.bind(this);\n\n        //channel.onOtherLeft = function(client) {\n        channel.onOtherDisconnected = function(clientId)\n        {\n            // validate\n            if (!this._aClientsOnThisPage[clientId]) return;\n\n            // toggle\n            this._aClientsOnThisPage[clientId].isToBeRemoved = true;\n\n            // update\n            this._updateAlsoOnThisPage(clientId);\n\n            // cleanup\n            delete this._aClientsOnThisPage[clientId];\n\n            // toggle visibility\n            this._toggleAlsoOnThisPageVisibility();\n\n        }.bind(this);\n\n\n\n        channel.receive('join', function(data, clientId)\n        {\n            this._aClientsOnThisPage[clientId] = {\n                isNew: true,\n                firstName: data.firstName,\n                lastName: data.lastName,\n                avatar: data.avatar\n            };\n\n            this._updateAlsoOnThisPage(clientId);\n\n            // toggle visibility\n            this._toggleAlsoOnThisPageVisibility();\n\n        }.bind(this));\n    },\n\n\n\n    _updateAlsoOnThisPage: function(userId)\n    {\n        \n        for (let clientId in this._aClientsOnThisPage)\n        {\n            // register\n            let client = this._aClientsOnThisPage[clientId];\n            \n\n            if (client.isNew)\n            {\n                // reset\n                delete client.isNew;\n\n                // init\n                client.element = this._alsoOnThisPageChannel.element.querySelector('[data-publisher-article-others-other-template]').cloneNode();\n\n                // add\n                this._alsoOnThisPageChannel.element.querySelector('[data-publisher-article-others-container]').appendChild(client.element);\n\n                // register\n                let elAvatarInitials = this._alsoOnThisPageChannel.element.querySelector('[data-publisher-article-others-other-initials]');\n\n                // set data\n                if (client.avatar) client.element.setAttribute('style', 'background-image:url(' + client.avatar + ');');\n\n\n                elAvatarInitials.innerText = client.firstName.substr(0, 1).toUpperCase() + client.lastName.substr(0, 1).toUpperCase();\n\n\n                console.log('isNew!');\n            }\n\n            if (client.isToBeRemoved)\n            {\n                // reset\n                delete client.isToBeRemoved;\n\n                console.log('isToBeRemoved!');\n\n\n                client.element.parentNode.removeChild(client.element);\n            }\n        }\n    },\n\n\n    _toggleAlsoOnThisPageVisibility: function()\n    {\n\n\n\n        let bHasItems = false;\n        for (let sKey in this._aClientsOnThisPage) { bHasItems = true; break; }\n\n\n        Mimoto.warn('!this._aClientsOnThisPage', !this._aClientsOnThisPage, bHasItems);\n\n        // toggle visibility\n        if (!bHasItems)\n        {\n            this._alsoOnThisPageChannel.element.classList.add('Mimoto_CoreCSS_hidden');\n        }\n        else\n        {\n            this._alsoOnThisPageChannel.element.classList.remove('Mimoto_CoreCSS_hidden');\n        }\n    },\n\n\n\n    // -----------\n    \n    \n\n    isTypingComment: function(channel)\n    {\n        // register\n        this._isTypingChannel = channel;\n\n        // find and register\n        this._elIsTypingMessage = document.querySelector('[data-publisher-conversation-istypingmessage]');\n\n\n\n        // initial setup\n        this._updateIsTypingMessage(channel.element);\n\n\n\n        channel.element.addEventListener('focus', function() {\n\n            // broadcast\n            channel.send('startsTyping', { firstName: Mimoto.user.firstName });\n        });\n\n        channel.element.addEventListener('blur', function() {\n\n            // broadcast\n            channel.send('stopsTyping', { firstName: Mimoto.user.firstName });\n        });\n\n        channel.receive('startsTyping', function(data)\n        {\n            // register\n            this._aUsersInCommentField.push(data.firstName);\n\n            // update\n            this._updateIsTypingMessage(channel.element);\n\n        }.bind(this));\n\n        channel.receive('stopsTyping', function(data)\n        {\n            // cleanup - #todo needs public id or id provided by realtime.js\n            let nUserCount = this._aUsersInCommentField.length;\n            for (let nUserIndex = 0; nUserIndex < nUserCount; nUserIndex++)\n            {\n                // verify\n                if (this._aUsersInCommentField[nUserIndex] === data.firstName)\n                {\n                    // remove\n                    this._aUsersInCommentField.splice(nUserIndex, 1);\n                    break;\n                }\n            }\n\n            // update\n            this._updateIsTypingMessage(channel.element);\n\n        }.bind(this))\n    },\n\n    _updateIsTypingMessage: function(element)\n    {\n        // init\n        let sMessage = '';\n\n        // compose\n        let nUserCount = this._aUsersInCommentField.length;\n        for (let nUserIndex = 0; nUserIndex < nUserCount; nUserIndex++)\n        {\n            // build\n            sMessage += this._aUsersInCommentField[nUserIndex];\n\n            // connect\n            if (nUserIndex < nUserCount - 1)\n            {\n                sMessage += (nUserCount === 2 || nUserIndex === nUserCount - 2) ? ' and ' : ', ';\n            }\n        }\n\n        // update interface\n        if (nUserCount === 0)\n        {\n            // cleanup\n            this._elIsTypingMessage.innerHTML = '&nbsp;';\n        }\n        else\n        {\n            this._elIsTypingMessage.innerText = sMessage + ' ' + ((nUserCount === 1) ? 'is' : 'are') + ' typing ..';\n        }\n\n    },\n    \n\n\n    /**\n     * Setup article\n     * @private\n     */\n    _setupArticle: function()\n    {\n        // init\n        const ARTICLE_SELECTOR = 'data-js-article';\n\n        // search\n        let articleElement = document.querySelector('[' + ARTICLE_SELECTOR + ']');\n\n        // verify\n        if (!articleElement) return;\n\n\n        console.log('Setting up article and editor ...');\n\n\n        // read\n        let nArticleId = articleElement.getAttribute(ARTICLE_SELECTOR);\n\n        // create\n        this.article = new Article(nArticleId);\n        this.editor = new Editor(nArticleId);\n    }\n\n};\n\n\n\n// WEBPACK FOOTER //\n// src/userinterface/publisher/Publisher/Publisher.js","/**\n * Mimoto.Publisher - Demo - How to build a publication platform\n *\n * @author Sebastian Kersten (@supertaboo)\n */\n\n\n'use strict';\n\n\nmodule.exports = function(nArticleId)\n{\n    // start\n    this.__construct(nArticleId);\n};\n\nmodule.exports.prototype = {\n\n\n    _nArticleId: null,\n\n\n    // ----------------------------------------------------------------------------\n    // --- Constructor ------------------------------------------------------------\n    // ----------------------------------------------------------------------------\n\n\n    /**\n     * Constructor\n     */\n    __construct: function(nArticleId)\n    {\n        // register\n        this._nArticleId = nArticleId;\n    },\n\n\n\n    // ----------------------------------------------------------------------------\n    // --- Public methods ---------------------------------------------------------\n    // ----------------------------------------------------------------------------\n\n\n    /**\n     * Add a comment to the article\n     * @param nArticleId\n     */\n    addComment: function()\n    {\n        // register\n        let commentForm = document.getElementById('commentForm');\n\n        // call\n        Mimoto.utils.callAPI({\n            type: 'post',\n            url: \"/publisher/article/\" + this._nArticleId + \"/comment/add\",\n            data: {message: commentForm.value},\n            dataType: 'json',\n            success: function(resultData, resultStatus, resultSomething) {\n                commentForm.value = '';\n                window.scrollTo(0,document.body.scrollHeight);\n            }\n        });\n    },\n\n    /**\n     * Report a comment\n     * @param nCommentId\n     */\n    reportComment: function(nCommentId)\n    {\n        // call\n        Mimoto.utils.callAPI({\n            type: 'post',\n            url: \"/publisher/comment/\" + nCommentId + \"/remove\",\n            data: {message: commentForm.value},\n            dataType: 'json',\n            success: function(resultData, resultStatus, resultSomething) {\n                console.log('Comment reported');\n            }\n        });\n    },\n\n    /**\n     * Highlight comment\n     * @param nCommentId\n     */\n    highlightComment: function(nCommentId)\n    {\n        // call\n        Mimoto.utils.callAPI({\n            type: 'post',\n            url: \"/publisher/comment/\" + nCommentId + \"/highlight\",\n            data: null,\n            dataType: 'json',\n            success: function(resultData, resultStatus, resultSomething) {\n                console.log('Comment highlighted');\n            }\n        });\n    },\n\n    /**\n     * Unhighlight comment\n     * @param nCommentId\n     */\n    unhighlightComment: function(nCommentId)\n    {\n        // call\n        Mimoto.utils.callAPI({\n            type: 'post',\n            url: \"/publisher/comment/\" + nCommentId + \"/unhighlight\",\n            data: null,\n            dataType: 'json',\n            success: function(resultData, resultStatus, resultSomething) {\n                console.log('Comment unhighlighted');\n            }\n        });\n    }\n\n};\n\n\n\n// WEBPACK FOOTER //\n// src/userinterface/publisher/Article/Article.js","/**\n * Mimoto.Publisher - Demo - How to build a publication platform\n *\n * @author Sebastian Kersten (@supertaboo)\n */\n\n\n'use strict';\n\n\n\nmodule.exports = function() {\n\n\n    // start\n    this.__construct();\n};\n\nmodule.exports.prototype = {\n\n\n    // ----------------------------------------------------------------------------\n    // --- Constructor ------------------------------------------------------------\n    // ----------------------------------------------------------------------------\n\n\n    /**\n     * Constructor\n     */\n    __construct: function()\n    {\n\n    },\n\n\n\n    // ----------------------------------------------------------------------------\n    // --- Public methods ---------------------------------------------------------\n    // ----------------------------------------------------------------------------\n\n\n    onInfocardAdd: function(NodeConfig)\n    {\n        console.log('Hi! from custom publisher onAdd function');\n\n        // 1. check if id is set\n        // 2. call popup, or\n        // 3. create comment\n\n        //let my_blot = Parchment.find(NodeConfig.node);\n\n\n        //let popup = Mimoto.popup('/Mimoto.Aimless/form/infocard');\n    },\n\n    onInfocardEdit: function(NodeConfig)\n    {\n        console.log('Hi! from custom publisher onEdit function');\n\n        // 1. check if id is set\n        // 2. call popup, or\n        // 3. create comment\n\n        let popup = Mimoto.popup('/Mimoto.Aimless/form/infocard');\n\n        // 4. delete formatting options (als mogelijke feedback van popup)\n        // 5. onInit (wanneer het op de dom geplaatst worden vanuit een saved state\n    }\n\n};\n\n\n\n// WEBPACK FOOTER //\n// src/userinterface/publisher/Editor/Editor.js"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;A;;;;;;ACnEA;;;;;;AAOA;AACA;AAEA;AACA;AAAA;AACA;AAEA;;;AAGA;AAEA;AACA;AAEA;;;;;;;;ACtBA;;;;;;AAOA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AAJA;AACA;AAMA;AACA;AACA;AACA;AAEA;AACA;AACA;AAGA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAIA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAGA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAGA;AACA;AAEA;AACA;AAGA;;;;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3SA;;;;;;;;ACrBA;;;;;;AAOA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAUA;AACA;AACA;;;;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AACA;AACA;;;;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AACA;AACA;;;;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AACA;AAtGA;;;;;;;;AChBA;;;;;;AAOA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlDA;;;;A","sourceRoot":""}