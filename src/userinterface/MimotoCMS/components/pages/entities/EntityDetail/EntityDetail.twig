{% extends "MimotoCMS/components/base.twig" %}

{% block content %}

    {% set extends = Aimless.data('extends.name') %}
    {# set extends_id = Aimless.meta('extends.id') #}{# todo #}
    {% set extends_id = Aimless.meta('id') %}{# todo #}


    {%
        embed "MimotoCMS/modules/TabmenuModule/TabmenuModule.twig" with {
            id: 'entitydetails',
            tabs: [
                {
                    label: 'Structure',
                    panel_id: 'panel_entitydetail_structure'
                },
                {
                    label: 'Instances',
                    panel_id: 'panel_entitydetail_instances'
                },
                {
                    label: 'More',
                    panel_id: 'panel_entitydetail_more',
                    secondary: true
                }
            ]
        }
    %}
        {% block panels %}

            <!-- structure -->

            <div id="panel_entitydetail_structure" class="MimotoCMS_modules_Tabmenu__panel">

                <div class="MimotoCMS_pages_entities_EntityDetail_Structure">

                    <div class="MimotoCMS_pages_entities_EntityDetail_Structure__meta">

                        <div class="MimotoCMS_pages_entities_EntityDetail_Structure__meta_info">

                            <span class="MimotoCMS_pages_entities_EntityDetail_Structure__entityname" {{ Aimless.realtime('name') }}>{{ Aimless.data('name') }}</span>

                            {% if entityStructure.extends is not empty %}
                                {% for extension in entityStructure.extends %}
                                    extends <b><a href="/mimoto.cms/entity/{{ extension.id }}/view"><span data-aimless-id="entity.{{ extension.id }}.name" class="MimotoCMS_pages_entities_EntityDetail_Structure__entityname">{{ extension.name }}</span></a></b>
                                {% endfor %}
                                <br>
                            {% endif %}

                            {% if entityStructure.extendedBy is not empty %}
                                <div class="MimotoCMS_pages_entities_EntityDetail_Structure__extendedby">
                                    Extended by:
                                    {% for extension in entityStructure.extendedBy %}
                                    <a href="/mimoto.cms/entity/{{ extension.id }}/view"><span data-aimless-value="_MimotoAimless__core__entity.{{ extension.id }}.name">{{ extension.name }}</span></a>{% if not loop.last %}, {% endif %}
                                    {% endfor %}
                                </div>
                            {% endif %}

                            <div class="MimotoCMS_pages_entities_EntityDetail_Structure__usage">
                                {% if entityStructure.hasTable %}
                                    This entity has {{ entityStructure.instanceCount }} instance{% if entityStructure.instanceCount != 1 %}s{%  endif %}
                                {% else %}
                                    This entity has no table of its own and is only used for extension purposes
                                {% endif %}
                            </div>

                        </div>

                        <div class="MimotoCMS_pages_entities_EntityDetail_Structure__meta_menu">
                            {{ Aimless.module('Mimoto.CMS.ButtonModule', { label:'Edit', icon:'', onclick:"Mimoto.CMS.entityEdit('" ~ Aimless.meta('id') ~ "');", types:['secondary'] }) }}
                        </div>

                    </div>


                    <div class="MimotoCMS_pages_entities_EntityDetail__block">

                        <div class="MimotoCMS_pages_entities_EntityDetail_Structure__properties_empty" {{ Aimless.showOnEmpty('properties') }}>
                            <div>This entity has no properties yet.<br>Go ahead, start adding them!</div>
                            <div>{{ Aimless.module('Mimoto.CMS.ButtonModule', { label:'Add new property', icon:'plus', onclick:"Mimoto.CMS.entityPropertyNew('" ~ Aimless.meta('id') ~ "');" }) }}</div>
                        </div>

                        <div {{ Aimless.hideOnEmpty('properties') }}>
                            <div class="MimotoCMS_pages_entities_EntityDetail_Structure__properties_container" {{ Aimless.realtime('properties', 'Mimoto.CMS_entities_EntityDetail-EntityProperty') }}>
                                {{ Aimless.render('properties', 'Mimoto.CMS_entities_EntityDetail-EntityProperty') }}
                            </div>

                            <div class="MimotoCMS_pages_entities_EntityDetail_Structure__properties_menu">
                                {{ Aimless.module('Mimoto.CMS.ButtonModule', { label:'Add new property', icon:'plus', onclick:"Mimoto.CMS.entityPropertyNew('" ~ Aimless.meta('id') ~ "');" }) }}
                            </div>
                        </div>

                    </div>

                </div>
            </div>

            <!-- instances -->

            <div id="panel_entitydetail_instances" class="MimotoCMS_modules_Tabmenu__panel hidden">

                <div class="MimotoCMS_pages_entities_EntityDetail_Instances">
                    [search fields]
                    <br>
                    <br>
                    {#<div class="MimotoCMS_pages_entities_EntityDetail_Properties__container" {{ Aimless.realtime('instances') }}>
                        {{ Aimless.data('instances') }}
                    </div>#}
                </div>

            </div>

            <!-- more -->

            <div id="panel_entitydetail_more" class="MimotoCMS_modules_Tabmenu__panel hidden">

                <b>Danger zone!</b><br>
                <br>
                <i><u>WARNING</u> - Deleting the entity will result in the LOSS OF ALL DATA related to this entity.</i><br>
                <br>
                {{ Aimless.module('Mimoto.CMS.ButtonModule', { label:'Delete entity', icon:'warning', onclick:"Mimoto.CMS.entityDelete(" ~ Aimless.meta('id') ~ ", '" ~ Aimless.data('name') ~ "');", types:['alert'] }) }}
            </div>

        {% endblock %}
    {% endembed %}


    {%
        embed "MimotoCMS/modules/TabmenuModule/TabmenuModule.twig" with {
            id: 'entityforms',
            tabs: [
                {
                    label: 'Forms',
                    panel_id: 'panel_entityforms'
                }
            ]
        }
    %}
        {% block panels %}

            <!-- forms -->

            <div id="panel_entityforms" class="MimotoCMS_modules_Tabmenu__panel hidden">

                <div class="MimotoCMS_pages_entities_EntityDetail__block">

                    <div class="MimotoCMS_pages_entities_EntityDetail_Structure__properties_empty" {{ Aimless.showOnEmpty('forms') }}>
                        <div>This entity has no form yet.<br>Go ahead, start adding one!</div>
                        <div>{{ Aimless.module('Mimoto.CMS.ButtonModule', { label:'Add new form', icon:'plus', onclick:"Mimoto.CMS.entityFormNew('" ~ Aimless.meta('id') ~ "');" }) }}</div>
                    </div>

                    <div {{ Aimless.hideOnEmpty('forms') }}>
                        <div class="MimotoCMS_pages_entities_EntityDetail_container" {{ Aimless.realtime('forms', 'Mimoto.CMS_entities_EntityDetail-Form') }}>
                            {{ Aimless.render('forms', 'Mimoto.CMS_entities_EntityDetail-Form') }}
                        </div>

                        <div class="MimotoCMS_pages_entities_EntityDetail_Structure__properties_menu">
                            {{ Aimless.module('Mimoto.CMS.ButtonModule', { label:'Add new form', icon:'plus', onclick:"Mimoto.CMS.entityFormNew('" ~ Aimless.meta('id') ~ "');" }) }}
                        </div>
                    </div>

                </div>

            </div>

        {% endblock %}
    {% endembed %}


    {%
        embed "MimotoCMS/modules/TabmenuModule/TabmenuModule.twig" with {
            id: 'entitycomponents',
            tabs: [
                {
                    label: 'Components',
                    panel_id: 'panel_entitycomponents'
                }
            ]
        }
    %}
        {% block panels %}

            <!-- components -->

            <div id="panel_entitycomponents" class="MimotoCMS_modules_Tabmenu__panel hidden">

                <div class="MimotoCMS_pages_entities_EntityDetail__block">

                    <div class="MimotoCMS_pages_entities_EntityDetail_Structure__properties_empty" {{ Aimless.showOnEmpty('components') }}>
                        <div>This entity has no component yet.<br>Go ahead, start adding one!</div>
                        <div>{{ Aimless.module('Mimoto.CMS.ButtonModule', { label:'Add new component', icon:'plus', onclick:"Mimoto.CMS.entityComponentNew('" ~ Aimless.meta('id') ~ "');" }) }}</div>
                    </div>

                    <div {{ Aimless.hideOnEmpty('components') }}>
                        <div class="MimotoCMS_pages_entities_EntityDetail_container" {{ Aimless.realtime('components', 'Mimoto.CMS_entities_EntityDetail-Component') }}>
                            {{ Aimless.render('components', 'Mimoto.CMS_entities_EntityDetail-Component') }}
                        </div>

                        <div class="MimotoCMS_pages_entities_EntityDetail_Structure__properties_menu">
                            {{ Aimless.module('Mimoto.CMS.ButtonModule', { label:'Add new component', icon:'plus', onclick:"Mimoto.CMS.entityComponentNew('" ~ Aimless.meta('id') ~ "');" }) }}
                        </div>
                    </div>

                </div>

                <br>

                <div class="MimotoCMS_pages_entities_EntityDetail__codeexample">

                    <div class="MimotoCMS_pages_entities_EntityDetail__codeexample-title">Twig example</div>

                    <div class="MimotoCMS_pages_entities_EntityDetail__codeexample-container">
                        <code>{{ "<div "|escape }}<span class="MimotoCMS_pages_entities_EntityDetail-EntityPropertyExample-aimless-code">{{ '{{ Aimless.realtime() }}' }}</span>&gt;</code>
                        <div class="MimotoCMS_pages_entities_EntityDetail__codeexample-properties" {{ Aimless.realtime('properties', 'Mimoto.CMS_entities_EntityDetail_EntityPropertyExample') }}>
                            {{ Aimless.render('properties', 'Mimoto.CMS_entities_EntityDetail_EntityPropertyExample') }}
                        </div>
                        <code>{{ "</div>"|escape }}</code>
                    </div>
                </div>

            </div>

        {% endblock %}
    {% endembed %}


{% endblock %}
